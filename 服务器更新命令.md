# 服务器更新命令

## 方法一：一键更新（推荐）

在服务器上直接执行以下命令：

```bash
cd /var/www/xfinds && git fetch origin main && git reset --hard origin/main && chmod +x scripts/deploy/quick-update.sh && ./scripts/deploy/quick-update.sh
```

## 方法二：分步执行（更安全）

如果一键命令失败，可以分步执行：

```bash
# 1. 进入项目目录
cd /var/www/xfinds

# 2. 获取最新代码（不合并）
git fetch origin main

# 3. 强制重置到远程版本（丢弃本地更改）
git reset --hard origin/main

# 4. 设置脚本执行权限
chmod +x scripts/deploy/quick-update.sh

# 5. 执行更新脚本
./scripts/deploy/quick-update.sh
```

## 方法三：使用 update-server.sh

如果服务器上已有 update-server.sh 文件：

```bash
cd /var/www/xfinds
chmod +x update-server.sh
./update-server.sh
```

## 更新脚本功能

更新脚本会自动执行以下操作：

1. ✅ 停止 PM2 进程
2. ✅ 配置 Git 远程仓库（使用 Token 认证）
3. ✅ 检查并处理本地更改冲突
4. ✅ 拉取最新代码（强制同步远程版本）
5. ✅ 清理构建缓存
6. ✅ 安装依赖更新
7. ✅ 重新构建项目
8. ✅ 重启 PM2 应用
9. ✅ 验证部署状态

## 如果遇到问题

### 问题1：Git 认证失败
```bash
# 手动设置远程 URL 使用 Token
cd /var/www/xfinds
git remote set-url origin https://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@github.com/TheNewMikeMusic/Xfinds.git
git fetch origin main
git reset --hard origin/main
```

### 问题2：权限不足
```bash
# 确保有执行权限
chmod +x scripts/deploy/quick-update.sh
chmod +x update-server.sh
```

### 问题3：PM2 进程问题
```bash
# 检查 PM2 状态
pm2 status

# 查看日志
pm2 logs xfinds --lines 50

# 手动重启
pm2 restart xfinds
```

## 验证更新是否成功

更新完成后，检查：

1. **PM2 状态**：
   ```bash
   pm2 status
   ```

2. **应用日志**：
   ```bash
   pm2 logs xfinds --lines 20
   ```

3. **端口监听**：
   ```bash
   netstat -tulpn | grep 8000
   ```

4. **访问网站**：
   - https://xfinds.cc

