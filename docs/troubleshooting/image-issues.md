# å›¾ç‰‡ç ´å›¾é—®é¢˜æ£€æŸ¥ä¸ä¿®å¤æŒ‡å—

## ğŸ” å·²å‘ç°çš„é—®é¢˜

### 1. æ–‡ä»¶ååŒ…å«ç©ºæ ¼ (3ä¸ª)
- `prod-13`: `/Nasa stusy.png`, `/Nasa stusy2.png`, `/Nasa stusy3.png`
- **é—®é¢˜**: URLä¸­çš„ç©ºæ ¼éœ€è¦ç¼–ç ä¸º`%20`ï¼Œå¯èƒ½å¯¼è‡´è·¯å¾„è§£æé”™è¯¯
- **å½±å“**: åœ¨LinuxæœåŠ¡å™¨ä¸Šå¯èƒ½å¯¼è‡´404é”™è¯¯

### 2. è·¯å¾„ä¸ä¸€è‡´ (2ä¸ª)
- `prod-25`: `/gr-y29-earbuds.png` åº”è¯¥ä½¿ç”¨ `/images/gr-y29-earbuds.png`
- **é—®é¢˜**: è·¯å¾„ä¸ç»Ÿä¸€ï¼Œå¯èƒ½å¯¼è‡´ç»´æŠ¤å›°éš¾
- **å½±å“**: è™½ç„¶ä¸ä¼šç›´æ¥å¯¼è‡´ç ´å›¾ï¼Œä½†å»ºè®®ç»Ÿä¸€

## ğŸ“‹ å¯èƒ½å¯¼è‡´ç ´å›¾çš„å®Œæ•´åŸå› åˆ—è¡¨

### 1. è·¯å¾„é—®é¢˜

#### 1.1 ç»å¯¹è·¯å¾„ vs ç›¸å¯¹è·¯å¾„
- âœ… **æ­£ç¡®**: `/images/product.png` (ç›¸å¯¹äºpublicç›®å½•)
- âŒ **é”™è¯¯**: `C:\Users\...` æˆ– `./images/product.png`
- **æ£€æŸ¥**: ç¡®ä¿æ‰€æœ‰å›¾ç‰‡è·¯å¾„ä»¥ `/` å¼€å¤´

#### 1.2 è·¯å¾„ä¸ä¸€è‡´
- æœ‰äº›å›¾ç‰‡åœ¨ `/images/` ç›®å½•ï¼Œæœ‰äº›åœ¨æ ¹ç›®å½• `/`
- **å»ºè®®**: ç»Ÿä¸€ä½¿ç”¨ `/images/` å‰ç¼€ï¼ˆé™¤äº†ç‰¹æ®Šæ–‡ä»¶å¦‚logoã€iconç­‰ï¼‰

#### 1.3 è·¯å¾„å¤§å°å†™æ•æ„Ÿ
- **Windows**: ä¸åŒºåˆ†å¤§å°å†™
- **LinuxæœåŠ¡å™¨**: åŒºåˆ†å¤§å°å†™
- **é—®é¢˜**: `Image.png` vs `image.png` åœ¨Linuxä¸Šä¼šè¢«è§†ä¸ºä¸åŒæ–‡ä»¶
- **è§£å†³**: ç»Ÿä¸€ä½¿ç”¨å°å†™æ–‡ä»¶å

### 2. æ–‡ä»¶åé—®é¢˜

#### 2.1 ç©ºæ ¼
- âŒ **é”™è¯¯**: `/Nasa stusy.png`
- âœ… **æ­£ç¡®**: `/nasa-stusy.png` æˆ– `/nasa_stusy.png`
- **é—®é¢˜**: URLéœ€è¦ç¼–ç ï¼Œå¯èƒ½å¯¼è‡´è§£æé”™è¯¯

#### 2.2 ç‰¹æ®Šå­—ç¬¦
- âŒ **é¿å…**: `!@#$%^&*()+=[]{}|;:'"<>?`
- âœ… **ä½¿ç”¨**: å­—æ¯ã€æ•°å­—ã€è¿å­—ç¬¦(-)ã€ä¸‹åˆ’çº¿(_)ã€ç‚¹(.)
- **é—®é¢˜**: ç‰¹æ®Šå­—ç¬¦éœ€è¦URLç¼–ç 

#### 2.3 ä¸­æ–‡æ–‡ä»¶å
- âŒ **é”™è¯¯**: `/äº§å“å›¾ç‰‡.png`
- âœ… **æ­£ç¡®**: `/product-image.png`
- **é—®é¢˜**: ç¼–ç é—®é¢˜ï¼Œåœ¨ä¸åŒç¯å¢ƒä¸‹å¯èƒ½å‡ºé”™

#### 2.4 æ–‡ä»¶åé•¿åº¦
- **å»ºè®®**: ä¸è¶…è¿‡255ä¸ªå­—ç¬¦
- **é—®é¢˜**: æŸäº›æ–‡ä»¶ç³»ç»Ÿé™åˆ¶æ–‡ä»¶åé•¿åº¦

### 3. Next.js Imageç»„ä»¶é—®é¢˜

#### 3.1 å›¾ç‰‡è·¯å¾„ç¼–ç 
- Next.js Imageç»„ä»¶ä¼šè‡ªåŠ¨å¤„ç†ç›¸å¯¹è·¯å¾„
- ä½†å¯¹äºåŒ…å«ç‰¹æ®Šå­—ç¬¦çš„è·¯å¾„ï¼Œå¯èƒ½éœ€è¦æ‰‹åŠ¨ç¼–ç 
- **å½“å‰ä»£ç **: æ²¡æœ‰ä½¿ç”¨ `encodeImagePath` å‡½æ•°

#### 3.2 å›¾ç‰‡ä¼˜åŒ–
- Next.jsä¼šè‡ªåŠ¨ä¼˜åŒ–å›¾ç‰‡
- å¦‚æœå›¾ç‰‡ä¼˜åŒ–å¤±è´¥ï¼Œå¯èƒ½å¯¼è‡´ç ´å›¾
- **æ£€æŸ¥**: `next.config.js` ä¸­çš„ `images` é…ç½®

#### 3.3 å¤–éƒ¨å›¾ç‰‡åŸŸå
- éœ€è¦åœ¨ `next.config.js` çš„ `remotePatterns` ä¸­é…ç½®
- **å½“å‰é…ç½®**: å·²åŒ…å«å¸¸è§åŸŸå

### 4. æœåŠ¡å™¨éƒ¨ç½²é—®é¢˜

#### 4.1 æ–‡ä»¶æœªä¸Šä¼ 
- **æ£€æŸ¥**: ç¡®ä¿æ‰€æœ‰å›¾ç‰‡æ–‡ä»¶éƒ½ä¸Šä¼ åˆ°æœåŠ¡å™¨
- **éªŒè¯**: æ£€æŸ¥ `public` ç›®å½•ä¸‹çš„æ–‡ä»¶

#### 4.2 æ–‡ä»¶æƒé™
- **Linux**: ç¡®ä¿æ–‡ä»¶æœ‰è¯»å–æƒé™ (`chmod 644`)
- **é—®é¢˜**: æƒé™ä¸è¶³å¯èƒ½å¯¼è‡´403é”™è¯¯

#### 4.3 é™æ€èµ„æºæœåŠ¡
- Next.jsä¼šè‡ªåŠ¨æœåŠ¡ `public` ç›®å½•
- **æ£€æŸ¥**: ç¡®ä¿æœåŠ¡å™¨æ­£ç¡®é…ç½®é™æ€èµ„æºè·¯å¾„

#### 4.4 æ„å»ºæ—¶æ–‡ä»¶ä¸¢å¤±
- **æ£€æŸ¥**: `.gitignore` æ˜¯å¦æ’é™¤äº†å›¾ç‰‡æ–‡ä»¶
- **é—®é¢˜**: å¦‚æœå›¾ç‰‡åœ¨ `.gitignore` ä¸­ï¼Œæ„å»ºæ—¶å¯èƒ½ä¸¢å¤±

### 5. ç½‘ç»œå’ŒCDNé—®é¢˜

#### 5.1 CDNç¼“å­˜
- å¦‚æœä½¿ç”¨CDNï¼Œå¯èƒ½éœ€è¦æ¸…é™¤ç¼“å­˜
- **é—®é¢˜**: æ—§ç‰ˆæœ¬å›¾ç‰‡å¯èƒ½è¢«ç¼“å­˜

#### 5.2 CORSé—®é¢˜
- è·¨åŸŸå›¾ç‰‡å¯èƒ½è¢«é˜»æ­¢
- **æ£€æŸ¥**: æµè§ˆå™¨æ§åˆ¶å°çš„CORSé”™è¯¯

### 6. ä»£ç é—®é¢˜

#### 6.1 é”™è¯¯å¤„ç†
- **å½“å‰**: `onError` å›è°ƒå·²å®ç°
- **æ£€æŸ¥**: ç¡®ä¿é”™è¯¯å¤„ç†æ­£ç¡®å·¥ä½œ

#### 6.2 å ä½ç¬¦
- **å½“å‰**: æœ‰å ä½ç¬¦å¤„ç†
- **æ£€æŸ¥**: ç¡®ä¿å ä½ç¬¦è·¯å¾„æ­£ç¡®

## ğŸ”§ ä¿®å¤å»ºè®®

### ç«‹å³ä¿®å¤

1. **é‡å‘½ååŒ…å«ç©ºæ ¼çš„æ–‡ä»¶**
   ```bash
   # é‡å‘½å Nasa stusy ç›¸å…³æ–‡ä»¶
   mv "public/Nasa stusy.png" "public/nasa-stusy.png"
   mv "public/Nasa stusy2.png" "public/nasa-stusy-2.png"
   mv "public/Nasa stusy3.png" "public/nasa-stusy-3.png"
   ```

2. **æ›´æ–° products.json ä¸­çš„è·¯å¾„**
   ```json
   {
     "cover": "/nasa-stusy.png",
     "gallery": [
       "/nasa-stusy-2.png",
       "/nasa-stusy-3.png"
     ]
   }
   ```

3. **ç»Ÿä¸€è€³æœºå›¾ç‰‡è·¯å¾„**
   ```json
   {
     "cover": "/images/gr-y29-earbuds.png",
     "gallery": [
       "/images/gr-y29-earbuds-2.png"
     ]
   }
   ```

### é•¿æœŸæ”¹è¿›

1. **æ·»åŠ å›¾ç‰‡è·¯å¾„éªŒè¯å‡½æ•°**
   ```typescript
   // lib/image-utils.ts
   export function validateImagePath(imagePath: string): boolean {
     // æ£€æŸ¥è·¯å¾„æ ¼å¼
     if (!imagePath.startsWith('/')) return false;
     
     // æ£€æŸ¥æ–‡ä»¶æ‰©å±•å
     const ext = path.extname(imagePath).toLowerCase();
     const allowedExts = ['.png', '.jpg', '.jpeg', '.gif', '.webp'];
     if (!allowedExts.includes(ext)) return false;
     
     // æ£€æŸ¥æ–‡ä»¶åæ ¼å¼ï¼ˆä¸å…è®¸ç©ºæ ¼å’Œç‰¹æ®Šå­—ç¬¦ï¼‰
     const filename = path.basename(imagePath);
     if (filename.includes(' ') || /[^a-zA-Z0-9._-]/.test(filename)) {
       return false;
     }
     
     return true;
   }
   ```

2. **åœ¨Imageç»„ä»¶ä¸­ä½¿ç”¨ç¼–ç **
   ```typescript
   import { encodeImagePath } from '@/lib/image-utils';
   
   <Image
     src={encodeImagePath(product.cover)}
     // ...
   />
   ```

3. **æ·»åŠ å›¾ç‰‡å­˜åœ¨æ€§æ£€æŸ¥**
   ```typescript
   // lib/data.ts
   export function validateProductImages(product: Product): string[] {
     const issues: string[] = [];
     
     if (product.cover && !fs.existsSync(path.join(process.cwd(), 'public', product.cover))) {
       issues.push(`Cover image not found: ${product.cover}`);
     }
     
     product.gallery?.forEach((img, idx) => {
       if (!fs.existsSync(path.join(process.cwd(), 'public', img))) {
         issues.push(`Gallery image ${idx} not found: ${img}`);
       }
     });
     
     return issues;
   }
   ```

## âœ… æ£€æŸ¥æ¸…å•

éƒ¨ç½²å‰æ£€æŸ¥ï¼š

- [ ] æ‰€æœ‰å›¾ç‰‡æ–‡ä»¶éƒ½å·²ä¸Šä¼ åˆ°æœåŠ¡å™¨
- [ ] æ–‡ä»¶åä¸åŒ…å«ç©ºæ ¼å’Œç‰¹æ®Šå­—ç¬¦
- [ ] è·¯å¾„ç»Ÿä¸€ä½¿ç”¨ `/images/` å‰ç¼€ï¼ˆé™¤äº†ç‰¹æ®Šæ–‡ä»¶ï¼‰
- [ ] æ–‡ä»¶åä½¿ç”¨å°å†™å­—æ¯å’Œè¿å­—ç¬¦
- [ ] æ£€æŸ¥ `products.json` ä¸­çš„è·¯å¾„æ˜¯å¦æ­£ç¡®
- [ ] éªŒè¯å›¾ç‰‡æ–‡ä»¶æƒé™ï¼ˆLinux: 644ï¼‰
- [ ] æµ‹è¯•å›¾ç‰‡åŠ è½½ï¼ˆæœ¬åœ°å’ŒæœåŠ¡å™¨ï¼‰
- [ ] æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰404é”™è¯¯
- [ ] éªŒè¯Next.js Imageä¼˜åŒ–æ˜¯å¦æ­£å¸¸å·¥ä½œ

## ğŸš€ éƒ¨ç½²åéªŒè¯

1. **æ£€æŸ¥å›¾ç‰‡URL**
   - è®¿é—® `https://yourdomain.com/images/product.png`
   - åº”è¯¥ç›´æ¥è¿”å›å›¾ç‰‡ï¼Œè€Œä¸æ˜¯404

2. **æ£€æŸ¥Next.js Imageä¼˜åŒ–**
   - è®¿é—® `https://yourdomain.com/_next/image?url=...`
   - åº”è¯¥è¿”å›ä¼˜åŒ–åçš„å›¾ç‰‡

3. **æµè§ˆå™¨å¼€å‘è€…å·¥å…·**
   - Networkæ ‡ç­¾ï¼šæ£€æŸ¥å›¾ç‰‡è¯·æ±‚çŠ¶æ€
   - Consoleæ ‡ç­¾ï¼šæ£€æŸ¥æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯

4. **ä½¿ç”¨æ£€æŸ¥è„šæœ¬**
   ```bash
   node scripts/check-image-issues.js
   ```

## ğŸ“ æ•…éšœæ’é™¤æ­¥éª¤

å¦‚æœå›¾ç‰‡ä»ç„¶æ— æ³•æ˜¾ç¤ºï¼š

1. **æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨**
   ```bash
   ls -la public/images/product.png
   ```

2. **æ£€æŸ¥æ–‡ä»¶æƒé™**
   ```bash
   chmod 644 public/images/product.png
   ```

3. **æ£€æŸ¥Next.jsé…ç½®**
   - éªŒè¯ `next.config.js` ä¸­çš„å›¾ç‰‡é…ç½®
   - æ£€æŸ¥ `remotePatterns` æ˜¯å¦æ­£ç¡®

4. **æ¸…é™¤ç¼“å­˜**
   ```bash
   rm -rf .next
   npm run build
   ```

5. **æ£€æŸ¥æœåŠ¡å™¨æ—¥å¿—**
   - æŸ¥çœ‹Nginx/Apacheæ—¥å¿—
   - æŸ¥çœ‹Next.jsæ„å»ºæ—¥å¿—

## ğŸ“š ç›¸å…³æ–‡ä»¶

- `scripts/check-image-issues.js` - å›¾ç‰‡é—®é¢˜æ£€æŸ¥è„šæœ¬
- `lib/image-utils.ts` - å›¾ç‰‡å·¥å…·å‡½æ•°
- `next.config.js` - Next.jsé…ç½®ï¼ˆå›¾ç‰‡ä¼˜åŒ–ï¼‰
- `components/search/product-card.tsx` - äº§å“å¡ç‰‡ç»„ä»¶
- `components/product/media-gallery.tsx` - åª’ä½“ç”»å»Šç»„ä»¶


