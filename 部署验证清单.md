# 部署验证清单

## ✅ 配置验证

### 1. 端口配置
- [x] `package.json` - start 脚本已配置为 `-p 8000`
- [x] `nginx.conf` - proxy_pass 已更新为 `http://localhost:8000`

### 2. 域名配置
- [x] `nginx.conf` - server_name 已配置为 `xfinds.cc` 和 `www.xfinds.cc`
- [x] 环境变量 - APP_URL 和 NEXT_PUBLIC_APP_URL 已更新为 `https://xfinds.cc`

### 3. HTTPS 配置
- [x] `nginx.conf` - HTTPS 服务器块已配置（443 端口）
- [x] `nginx.conf` - SSL 证书路径已配置
- [x] `nginx.conf` - HTTP 到 HTTPS 重定向已配置
- [x] `setup-https.sh` - Let's Encrypt 证书配置脚本已创建

### 4. 部署脚本
- [x] `DEPLOY.md` - 一键部署脚本已更新
- [x] `DEPLOY.md` - 防火墙规则已更新（80, 443, 8000）
- [x] `DEPLOY.md` - Nginx 配置步骤已添加
- [x] `DEPLOY.md` - HTTPS 配置说明已添加

### 5. GitHub 提交
- [x] 所有更改已提交到 GitHub
- [x] 最新提交哈希：`dae0c16`

## 📋 部署前检查清单

### 服务器端前置条件
- [ ] 域名 `xfinds.cc` DNS 记录已正确解析到 `154.21.200.177`
- [ ] 服务器可以访问 GitHub（或使用 Token）
- [ ] 服务器已安装 Node.js 和 npm
- [ ] 服务器已安装 PM2
- [ ] 服务器已安装 Nginx（或将在部署时安装）

### 防火墙配置
- [ ] 80 端口已开放（HTTP）
- [ ] 443 端口已开放（HTTPS）
- [ ] 8000 端口已开放（应用端口）

## 🚀 部署步骤

1. **连接到服务器**
   ```bash
   ssh root@154.21.200.177
   ```

2. **执行一键部署命令**
   ```bash
   # 复制并执行部署脚本（见 DEPLOY.md 或 服务器更新指令.md）
   ```

3. **验证部署**
   ```bash
   # 检查 PM2 状态
   pm2 status
   
   # 检查应用日志
   pm2 logs xfinds
   
   # 检查 Nginx 状态
   systemctl status nginx
   
   # 检查 SSL 证书（如果已配置）
   certbot certificates
   
   # 测试 HTTPS
   curl -I https://xfinds.cc
   ```

## 🔍 验证项目

### 应用验证
- [ ] PM2 进程运行正常
- [ ] 应用监听在 8000 端口
- [ ] 应用日志无错误

### Nginx 验证
- [ ] Nginx 配置测试通过 (`nginx -t`)
- [ ] Nginx 服务运行正常
- [ ] HTTP 请求正确重定向到 HTTPS

### HTTPS 验证
- [ ] SSL 证书已获取（首次部署需要）
- [ ] HTTPS 访问正常
- [ ] 证书自动续期已配置

### 域名验证
- [ ] `https://xfinds.cc` 可访问
- [ ] `http://xfinds.cc` 自动重定向到 HTTPS
- [ ] `www.xfinds.cc` 也可访问（如果配置）

## 📝 配置文件位置

- **应用目录**: `/var/www/xfinds`
- **Nginx 配置**: `/etc/nginx/sites-available/xfinds`
- **SSL 证书**: `/etc/letsencrypt/live/xfinds.cc/`
- **环境变量**: `/var/www/xfinds/.env.local`
- **PM2 配置**: `~/.pm2/`

## ⚠️ 常见问题

### 如果 HTTPS 证书获取失败
1. 确认域名 DNS 已正确解析
2. 确认 80 端口已开放
3. 手动执行：`certbot --nginx -d xfinds.cc -d www.xfinds.cc`

### 如果应用无法启动
1. 检查端口 8000 是否被占用：`netstat -tulpn | grep 8000`
2. 检查应用日志：`pm2 logs xfinds`
3. 检查环境变量：`cat /var/www/xfinds/.env.local`

### 如果 Nginx 配置失败
1. 测试配置：`nginx -t`
2. 检查配置语法
3. 查看错误日志：`tail -f /var/log/nginx/error.log`

## 📞 支持

如有问题，请检查：
- PM2 日志：`pm2 logs xfinds`
- Nginx 日志：`/var/log/nginx/xfinds-error.log`
- 系统日志：`journalctl -u nginx`

